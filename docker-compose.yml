services:
  # üóÑÔ∏è PostgreSQL Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Ï∂îÍ∞Ä (Î°úÏª¨ PostgreSQL ÏÇ¨Ïö©)
  postgres:
    image: postgres:15-alpine
    container_name: postgres-db
    environment:
      POSTGRES_DB: search_exchange_db
      POSTGRES_USER: admin
      POSTGRES_PASSWORD: your_secure_password_123
    ports:
      - "5433:5432" # Îã§Î•∏ Ìè¨Ìä∏ ÏÇ¨Ïö©
    volumes:
      - postgres_data:/var/lib/postgresql/data
    networks:
      - app-network
    healthcheck:
      test: [ "CMD-SHELL", "pg_isready -U admin -d search_exchange_db" ]
      interval: 10s
      timeout: 5s
      retries: 5

  # üìä pgAdmin (Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Í¥ÄÎ¶¨ ÎèÑÍµ¨)
  pgadmin:
    image: dpage/pgadmin4:latest
    container_name: pgadmin
    environment:
      PGADMIN_DEFAULT_EMAIL: admin@example.com
      PGADMIN_DEFAULT_PASSWORD: admin123
    ports:
      - "5050:80"
    volumes:
      - pgadmin_data:/var/lib/pgadmin
    networks:
      - app-network
    depends_on:
      postgres:
        condition: service_healthy

  # üîç Analysis Service
  analysis-service:
    build: ./services/analysis-service
    container_name: analysis-service
    ports:
      - "8001:8001"
    env_file:
      - .env
    environment:
      - DATABASE_URL=postgresql://admin:your_secure_password_123@postgres:5432/search_exchange_db
      - GEMINI_API_KEY=AIzaSyCj2lffHsQjeptA4y7kcLf9arIDbDMObS8
      - GEMINI_MODEL=models/gemini-flash-latest
    networks:
      - app-network
    depends_on:
      postgres:
        condition: service_healthy

  # üè™ Auction Service
  auction-service:
    build: ./services/auction-service
    container_name: auction-service
    ports:
      - "8002:8002"
    environment:
      - DATABASE_URL=postgresql://admin:your_secure_password_123@postgres:5432/search_exchange_db
      - REDIRECT_BASE_URL=${REDIRECT_BASE_URL}
    networks:
      - app-network
    depends_on:
      postgres:
        condition: service_healthy

  # üí∞ Payment Service
  payment-service:
    build: ./services/payment-service
    container_name: payment-service
    ports:
      - "8003:8003"
    environment:
      - DATABASE_URL=postgresql://admin:your_secure_password_123@postgres:5432/search_exchange_db
      - JWT_SECRET_KEY=digisafe-super-secret-jwt-key-2024-production-ready-32-chars
      - JWT_ALG=HS256
      - JWT_ISSUER=digisafe-api
      - JWT_AUDIENCE=digisafe-client
      - ACCESS_TOKEN_EXPIRE_MINUTES=30
    networks:
      - app-network
    depends_on:
      postgres:
        condition: service_healthy

  # ‚úÖ Verification Service
  verification-service:
    build: ./services/verification-service
    container_name: verification-service
    ports:
      - "8004:8004"
    environment:
      - DATABASE_URL=postgresql://admin:your_secure_password_123@postgres:5432/search_exchange_db
      - SETTLEMENT_SERVICE_URL=http://settlement-service:8003
    networks:
      - app-network
    depends_on:
      postgres:
        condition: service_healthy

  # üí∞ Settlement Service (Ï†ïÏÇ∞ ÏÑúÎπÑÏä§)
  settlement-service:
    build: ./services/settlement-service
    container_name: settlement-service
    ports:
      - "8008:8003"
    environment:
      - DATABASE_URL=postgresql://admin:your_secure_password_123@postgres:5432/search_exchange_db
      - JWT_SECRET_KEY=digisafe-super-secret-jwt-key-2024-production-ready-32-chars
      - JWT_ALG=HS256
      - JWT_ISSUER=digisafe-api
      - JWT_AUDIENCE=digisafe-client
      - ACCESS_TOKEN_EXPIRE_MINUTES=30
    networks:
      - app-network
    depends_on:
      postgres:
        condition: service_healthy

  # üë§ User Service
  user-service:
    build: ./services/user-service
    container_name: user-service
    ports:
      - "8005:8005"
    environment:
      - DATABASE_URL=postgresql://admin:your_secure_password_123@postgres:5432/search_exchange_db
      - JWT_SECRET_KEY=digisafe-super-secret-jwt-key-2024-production-ready-32-chars
      - JWT_ALG=HS256
      - JWT_ISSUER=digisafe-api
      - JWT_AUDIENCE=digisafe-client
      - ACCESS_TOKEN_EXPIRE_MINUTES=30
    networks:
      - app-network
    depends_on:
      postgres:
        condition: service_healthy

  # ‚úÖ Quality Service
  quality-service:
    build: ./services/quality-service
    container_name: quality-service
    ports:
      - "8006:8006"
    environment:
      - DATABASE_URL=postgresql://admin:your_secure_password_123@postgres:5432/search_exchange_db
    networks:
      - app-network
    depends_on:
      postgres:
        condition: service_healthy

  # üè¢ Advertiser Service
  advertiser-service:
    build: ./services/advertiser-service
    container_name: advertiser-service
    ports:
      - "8007:8007"
    environment:
      - DATABASE_URL=postgresql://admin:your_secure_password_123@postgres:5432/search_exchange_db
      - JWT_SECRET_KEY=digisafe-super-secret-jwt-key-2024-production-ready-32-chars
      - JWT_ALG=HS256
      - JWT_ISSUER=digisafe-api
      - JWT_AUDIENCE=digisafe-client
      - ACCESS_TOKEN_EXPIRE_MINUTES=30
      - WEBSITE_ANALYSIS_SERVICE_URL=http://website-analysis-service:8009
    networks:
      - app-network
    depends_on:
      postgres:
        condition: service_healthy

  # üåê Website Analysis Service (AI Í∏∞Î∞ò ÏõπÏÇ¨Ïù¥Ìä∏ Î∂ÑÏÑù)
  website-analysis-service:
    build:
      context: ./services/website-analysis-service
    container_name: website-analysis-service
    ports:
      - "8009:8009"
    environment:
      - DATABASE_URL=postgresql://admin:your_secure_password_123@postgres:5432/search_exchange_db
      - GEMINI_API_KEY=AIzaSyCj2lffHsQjeptA4y7kcLf9arIDbDMObS8
      - GEMINI_MODEL=models/gemini-flash-latest
    networks:
      - app-network
    depends_on:
      postgres:
        condition: service_healthy
    restart: on-failure

  # üåê API Gateway
  api-gateway:
    build: ./services/api-gateway
    container_name: api-gateway
    ports:
      - "8000:8000"
    environment:
      - JWT_SECRET_KEY=digisafe-super-secret-jwt-key-2024-production-ready-32-chars
      - JWT_ALG=HS256
      - JWT_ISSUER=digisafe-api
      - JWT_AUDIENCE=digisafe-client
      - PORT=8000
      - CORS_ALLOW_ORIGINS=http://localhost:3000
      - USER_SERVICE_URL=http://user-service:8005
      - ADVERTISER_SERVICE_URL=http://advertiser-service:8007
      - AUCTION_SERVICE_URL=http://auction-service:8002
      - PAYMENT_SERVICE_URL=http://payment-service:8003
      - SETTLEMENT_SERVICE_URL=http://settlement-service:8003
      - QUALITY_SERVICE_URL=http://quality-service:8006
      - ANALYSIS_SERVICE_URL=http://analysis-service:8001
      - VERIFICATION_SERVICE_URL=http://verification-service:8004
      - WEBSITE_ANALYSIS_SERVICE_URL=http://website-analysis-service:8009
    networks:
      - app-network
    depends_on:
      - user-service
      - advertiser-service
      - auction-service
      - payment-service
      - settlement-service
      - quality-service
      - analysis-service
      - verification-service
      - website-analysis-service

  # üåê Frontend
  frontend:
    build: .
    container_name: frontend
    ports:
      - "3000:3000"
    environment:
      - JWT_SECRET_KEY=digisafe-super-secret-jwt-key-2024-production-ready-32-chars
      - API_GATEWAY_URL=http://api-gateway:8000
      - USER_SERVICE_URL=http://user-service:8005
      - ADVERTISER_SERVICE_URL=http://advertiser-service:8007
      - PAYMENT_SERVICE_URL=http://payment-service:8003
      - SETTLEMENT_SERVICE_URL=http://settlement-service:8003
      - ANALYSIS_SERVICE_URL=http://analysis-service:8001
      - AUCTION_SERVICE_URL=http://auction-service:8002
      - VERIFICATION_SERVICE_URL=http://verification-service:8004
      - QUALITY_SERVICE_URL=http://quality-service:8006
      - WEBSITE_ANALYSIS_SERVICE_URL=http://website-analysis-service:8009
    networks:
      - app-network
    depends_on:
      - api-gateway
      - analysis-service
      - auction-service
      - payment-service
      - settlement-service
      - verification-service
      - user-service
      - advertiser-service
      - quality-service
      - website-analysis-service

# üì¶ Î≥ºÎ•® Ï†ïÏùò (Îç∞Ïù¥ÌÑ∞ ÏòÅÍµ¨ Î≥¥Ï°¥Ïö©)
volumes:
  postgres_data:
    driver: local
  pgadmin_data:
    driver: local

# üåê ÎÑ§Ìä∏ÏõåÌÅ¨ Ï†ïÏùò
networks:
  app-network:
    driver: bridge
